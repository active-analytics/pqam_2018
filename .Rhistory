#     (((total_pnl + dbl_starting_aum) / dbl_starting_aum) ^
#          (252 / int_trade_days)) - 1
# , sharpe = (mean(dly_ret) / sd(dly_ret)) * sqrt(252)
)
df_strategy_comp %>% filter(is.na(dly_pnl))
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
dt_max + 1
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/05_wrangler_risk_management_pnl.R', echo=TRUE)
# write data to csv
write_csv(df_managed_pnl, "spy_monthly_2018_2014_managed_pnl_010_300.csv")
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/05_wrangler_risk_management_pnl.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/05_wrangler_risk_management_pnl.R', echo=TRUE)
source('~/files/ods/plx_2018/script/05_wrangler_risk_management_pnl.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/05_wrangler_risk_management_pnl.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/01_wrangler_market.R', echo=TRUE)
#-------------------#
# writing csv files #
#-------------------#
#write_csv(df_chain, "dia_weekly_2014_2018_chain_desc.csv")
write_csv(df_chain_hist, "iwm_weekly_2014_2018_chain_hist.csv")
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
df_strategy_comp %>%
ggplot() +
geom_line(aes(x = trade_date, y = eod_aum, color = strategy))
source('~/files/ods/plx_2018/script/05_wrangler_risk_management_pnl.R', echo=TRUE)
# write data to csv
write_csv(df_managed_pnl, "iwm_2014_2018_managed_pnl_100_200.csv")
source('~/files/ods/plx_2018/script/05_wrangler_risk_management_pnl.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/01_wrangler_market.R', echo=TRUE)
#-------------------#
# writing csv files #
#-------------------#
#write_csv(df_chain, "dia_weekly_2014_2018_chain_desc.csv")
write_csv(df_chain_hist, "dia_weekly_2014_2018_chain_hist.csv")
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/05_wrangler_risk_management_pnl.R', echo=TRUE)
# write data to csv
write_csv(df_managed_pnl, "dia_weeky_2014_2018_managed_pnl_010_300.csv")
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/05_wrangler_risk_management_pnl.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
source('~/files/ods/plx_2018/script/06_wrangler_sitout_commission_aum_return.R', echo=TRUE)
64 - (6 * 1.15)
409 - (31 * 1.15)
library(tidyverse)
df_pnl <- read_csv("data_output/spy_monthly_2014_2018_pnl_scaled.csv")
df_pnl
View(df_pnl)
df_pnl %>%
filter(variation == 0.1) %>%
filter(strategy = "call")
df_pnl %>%
filter(variation == 0.1) %>%
filter(strategy == "call")
filter(year(expiration) == 2018)
library(lubridate)
df_pnl %>%
filter(variation == 0.1) %>%
filter(strategy == "call")
df_pnl %>%
filter(variation == 0.1) %>%
filter(strategy == "call") %>%
filter(year(expiration) == 2018)
df_spy_call <-
df_pnl %>%
filter(variation == 0.1) %>%
filter(strategy == "call") %>%
filter(year(expiration) == 2018)
View(df_spy_call)
df_spy_call %>%
filter(data_date == expiration) %>%
filter(strike < underlying_price)
df_chain_desc <- read_csv("data_output/spy_monthly_2014_2018_chain_desc.csv")
View(df_chain_desc)
df_spy_call <-
df_pnl %>%
filter(variation == 0.3) %>%
filter(strategy == "call") %>%
filter(year(expiration) == 2018)
df_spy_call %>%
filter(data_date == expiration) %>%
filter(strike < underlying_price)
df_spy_call %>%
filter(data_date == expiration) %>%
filter(strike < underlying_price) %>%
View()
df_chain_desc %>%
filter(year(expiration) == 2018)
View(df_chain_desc)
df_scaling <- read_csv("data_output/spy_monthly_2014_2018_position_scaling.csv")
View(df_scaling)
##############################
## creating trades database ##
##############################
df_trades <-
df_scaling %>% filter(year(expiration) == 2018)
View(df_trades)
##############################
## creating trades database ##
##############################
df_trades <-
df_scaling %>%
filter(year(expiration) == 2018) %>%
filter(varition == 0.5)
##############################
## creating trades database ##
##############################
df_trades <-
df_scaling %>%
filter(year(expiration) == 2018) %>%
filter(variation == 0.5)
##############################
## creating trades database ##
##############################
df_trades <-
df_scaling %>%
filter(year(expiration) == 2018) %>%
filter(variation == 0.3)
##############################
## creating trades database ##
##############################
df_trades <-
df_scaling %>%
filter(year(expiration) == 2018) %>%
filter(variation == 0.3) %>%
mutate(
direction = "sell"
, quantity = 1L
, type = "call"
)
##############################
## creating trades database ##
##############################
df_trades <-
df_scaling %>%
filter(year(expiration) == 2018) %>%
filter(variation == 0.3) %>%
mutate(
direction = "sell"
, quantity = 1L
, type = "call"
) %>%
select(
execution_date, direction, quantity, underlying, type
, expiration, execution_date, d2x, trade_price = call_bid
)
##############################
## creating trades database ##
##############################
df_trades <-
df_scaling %>%
filter(year(expiration) == 2018) %>%
filter(variation == 0.3) %>%
mutate(
direction = "sell"
, quantity = 1L
, type = "call"
) %>%
select(
execution_date = execution, direction, quantity, underlying, type
, expiration, execution_date, d2x, trade_price = call_bid
)
##############################
## creating trades database ##
##############################
df_trades <-
df_scaling %>%
filter(year(expiration) == 2018) %>%
filter(variation == 0.3) %>%
mutate(
direction = "sell"
, quantity = 1L
, type = "call"
) %>%
select(
execution_date = execution, direction, quantity, underlying, type
, expiration, execution_date, d2x, trade_price = call_bid
)
df_trades <-
df_scaling %>%
filter(year(expiration) == 2018) %>%
filter(variation == 0.3) %>%
mutate(
direction = "sell"
, quantity = 1L
, type = "call"
)
View(df_trades)
##############################
## creating trades database ##
##############################
df_trades <-
df_scaling %>%
filter(year(expiration) == 2018) %>%
filter(variation == 0.3) %>%
mutate(
direction = "sell"
, quantity = 1L
, type = "call"
#)
) %>%
select(
execution_date = execution, direction, quantity, underlying, type
, expiration, execution_date, d2x, trade_price = call_bid
)
source('~/files/ods/plx_2018/test/20190220_fm5990.R', echo=TRUE)
df_trades <-
df_scaling %>%
filter(year(expiration) == 2018) %>%
filter(variation == 0.3) %>%
mutate(
direction = "sell"
, quantity = 1L
, type = "call"
#)
) %>%
select(
execution_date = execution, direction, quantity, underlying, type
, expiration, d2x, trade_price = call.bid
)
##############################
## creating trades database ##
##############################
df_trades <-
df_scaling %>%
filter(year(expiration) == 2018) %>%
filter(variation == 0.3) %>%
mutate(
direction = "sell"
, quantity = 1L
, type = "call"
#)
) %>%
select(
execution_date = execution, direction, quantity, underlying, type
, expiration, d2x, trade_price = bid.call
)
View(df_trades)
############################
## creating pnl dataframe ##
############################
df_call_pnl <-
df_pnl %>%
filter(variation == 0.3) %>%
filter(strategy == "call") %>%
filter(year(expiration) == 2018)
View(df_call_pnl)
df_call_pnl <-
df_pnl %>%
filter(variation == 0.3) %>%
filter(strategy == "call") %>%
filter(year(expiration) == 2018) %>%
select(
underlying, upx, type, expiration, data_date, strike, bid, ask
, implied_vol, delta, dly_opt_pnl, dly_dh_pnl
)
############################
## creating pnl dataframe ##
############################
df_call_pnl <-
df_pnl %>%
filter(variation == 0.3) %>%
filter(strategy == "call") %>%
filter(year(expiration) == 2018) %>%
select(
underlying = underlying_symbol, upx = underlying_price, type, expiration
, data_date, strike, bid, ask, implied_vol, delta, dly_opt_pnl, dly_dh_pnl
)
################################
## adding strike to df_trades ##
################################
df_trades %>%
left_join(
df_pnl
, by = c("underlying", "expiration", "execution_date"="data_date")
)
################################
## adding strike to df_trades ##
################################
df_trades %>%
left_join(
df_call_pnl
, by = c("underlying", "expiration", "execution_date"="data_date")
)
################################
## adding strike to df_trades ##
################################
df_trades %>%
left_join(
df_call_pnl
, by = c("underlying", "expiration", "execution_date"="data_date")
) %>%
select(execution_date:trade_price, strike)
################################
## adding strike to df_trades ##
################################
df_trades %>%
left_join(
df_call_pnl %>% select(underlying, expiration, data_date, strike)
, by = c("underlying", "expiration", "execution_date"="data_date")
)
################################
## adding strike to df_trades ##
################################
df_trades %>%
left_join(
df_call_pnl %>% select(underlying, expiration, data_date, strike)
, by = c("underlying", "expiration", "execution_date"="data_date")
) %>%
select(
execution_date:type, strike, expiration:trade_price
)
################################
## adding strike to df_trades ##
################################
df_trades <-
df_trades %>%
left_join(
df_call_pnl %>% select(underlying, expiration, data_date, strike)
, by = c("underlying", "expiration", "execution_date"="data_date")
) %>%
select(
execution_date:type, strike, expiration:trade_price
)
###############
## questions ##
###############
# 1) d
df_trades$d2x %>% sum()
###############
## questions ##
###############
# 1) d
df_trades$d2x %>% sum() + 12
df_nrow$call_pnl
df_call_pnl %>% nrow()
write_csv(df_trades, "spy_2018_call_trade.csv")
write_csv(df_call_pnl, "spy_2018_call_pnl.csv")
library(tidyquant)
library(tidyquant)
df_IWM_TNA <-
tq_get(chr_symbol, get="stock.prices", from="2014-01-01", to="2019-01-01")
chr_symbol <- c("IWM", "TNA")
df_IWM_TNA <-
tq_get(chr_symbol, get="stock.prices", from="2014-01-01", to="2019-01-01")
View(df_IWM_TNA)
df_IWM_TNA %>%
tq_transmute(
select = adjusted
, mutate_fun = periodReturn
, period = "daily"
)
source('~/files/ods/plx_2018/test/20190220_fm5990.R', echo=TRUE)
source('~/files/ods/plx_2018/test/20190220_fm5990.R', echo=TRUE)
df_IWM_TNA %>%
group_by(symbol) %>%
tq_transmute(
select = adjusted
, mutate_fun = periodReturn
, period = "daily"
)
df_IWM_TNA_ret <-
df_IWM_TNA_px %>%
group_by(symbol) %>%
tq_transmute(
select = adjusted
, mutate_fun = periodReturn
, period = "daily"
)
df_IWM_TNA_px <-
tq_get(chr_symbol, get="stock.prices", from="2014-01-01", to="2019-01-01")
df_IWM_TNA_ret <-
df_IWM_TNA_px %>%
group_by(symbol) %>%
tq_transmute(
select = adjusted
, mutate_fun = periodReturn
, period = "daily"
)
df_IWM_TNA_px %>%
left_join(
df_IWM_TNA_ret
, by = c("symbol", "date")
)
df_IWM_TNA_ret <-
df_IWM_TNA_px %>%
group_by(symbol) %>%
tq_transmute(
select = adjusted
, mutate_fun = periodReturn
, period = "daily"
, col_rename = "return"
)
df_IWM_TNA_px %>%
left_join(
df_IWM_TNA_ret
, by = c("symbol", "date")
)
df_IWM_TNA <-
df_IWM_TNA_px %>%
left_join(
df_IWM_TNA_ret
, by = c("symbol", "date")
)
write_csv(df_IWM_TNA, "IWM_TNA_2014_2018.csv")
############################
## simple call assignment ##
############################
df_call_pnl
############################
## simple call assignment ##
############################
df_call_pnl %>%
filter(expiration == data_date) %>%
filter(upx > strike)
############################
## simple call assignment ##
############################
df_call_pnl %>%
filter(expiration == data_date) %>%
filter(upx < strike)
############################
## simple call assignment ##
############################
df_call_pnl %>%
filter(expiration == data_date) %>%
filter(upx > strike)
############################
## simple call assignment ##
############################
df_call_pnl %>%
filter(expiration == data_date) %>%
filter(upx < strike)
df_call_pnl %>%
filter(expiration %in% c("2018-09-21", "2018-12-21"))
df_call_pnl %>%
filter(expiration %in% c(as.Date("2018-09-21"), as.Date("2018-12-21")))
View(df_call_pnl)
df_simple_call <-
df_call_pnl %>%
filter(
expiration %in% c(as.Date("2018-09-21"), as.Date("2018-12-21"))
)
View(df_simple_call)
df_simple_call <-
df_simple_call %>%
mutate(
mid = (bid + ask) / 2
)
df_simple_call %>%
select(
underlying, upx, type, expiration, data_date, strike
, bid, ask, mid, delta)
df_simple_call <-
df_simple_call %>%
select(
underlying, upx, type, expiration, data_date, strike
, bid, ask, mid, delta)
write_csv(df_simple_call, "spy_call_pnl.csv")
df_call_pnl %>%
filter(expiration == data_date) %>%
filter(upx < strike)
df_simple_call <-
df_call_pnl %>%
filter(
expiration %in% c(as.Date("2018-09-21"))
)
df_simple_call <-
df_simple_call %>%
mutate(
mid = (bid + ask) / 2
)
df_simple_call <-
df_simple_call %>%
select(
underlying, upx, type, expiration, data_date, strike
, bid, ask, mid, delta)
write_csv(df_simple_call, "spy_call_pnl.csv")
